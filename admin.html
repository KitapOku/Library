<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

const firebaseConfig = { /* deine Config hier */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

document.addEventListener("DOMContentLoaded", () => {
  // DOM-Elemente Auswahl
  const loginForm = document.getElementById("login-form");
  const adminPanel = document.getElementById("admin-panel");
  const bookForm = document.getElementById("book-form");
  const booksContainer = document.getElementById("books");
  const settingsForm = document.getElementById("settings-form");
  const settingsDocRef = doc(db, "settings", "siteContent");

  // Login-Submit
  loginForm.addEventListener("submit", async e => {
    e.preventDefault();
    await signInWithEmailAndPassword(auth, loginForm.email.value, loginForm.password.value);
  });

  // Auth-State und Daten laden
  onAuthStateChanged(auth, user => {
    if (user) {
      loginForm.style.display = "none";
      adminPanel.style.display = "block";
      loadBooks();
      loadSettings();
    }
  });

  // Bücher laden
  async function loadBooks() {
    booksContainer.innerHTML = "Lade Bücher...";
    const snap = await getDocs(collection(db, "books"));
    booksContainer.innerHTML = "";
    snap.forEach(d => {
      const data = d.data();
      booksContainer.innerHTML += `<div><strong>${data.title}</strong> (${data.available ? "✓" : "✗"})</div>`;
    });
  }

  // Buch-Form-Submit
  bookForm.addEventListener("submit", async e => {
    e.preventDefault();
    await addDoc(collection(db, "books"), {
      title: bookForm.title.value,
      author: bookForm.author.value,
      cover: bookForm.cover.value,
      available: bookForm.available.checked,
      availableFrom: bookForm.availableFrom.value,
      createdAt: serverTimestamp()
    });
    bookForm.reset();
    loadBooks();
  });

  // Settings laden/speichern
  async function loadSettings() {
    const snap = await getDoc(settingsDocRef);
    if (snap.exists()) {
      const data = snap.data();
      settingsForm.thankYouMessage.value = data.thankYouMessage || "";
      settingsForm.headerText.value = data.headerText || "";
      settingsForm.footerText.value = data.footerText || "";
    }
  }
  settingsForm.addEventListener("submit", async e => {
    e.preventDefault();
    await setDoc(settingsDocRef, {
      thankYouMessage: settingsForm.thankYouMessage.value,
      headerText: settingsForm.headerText.value,
      footerText: settingsForm.footerText.value
    });
    alert("Einstellungen gespeichert");
  });
});
</script>


